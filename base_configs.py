neural_sfm_configs = {'triangulation_mode': False, 'NEUSFM_enable_post_optimization': False, 'NEUSFM_refinement_chunk_size': 2000, \
'NEUSFM_fine_match_model_path': 'save_weight/dim7.ckpt', 'NEUSFM_fine_match_cfg_path': 'hydra_training_configs/experiment/multiview_refinement_matching.yaml', \
'n_images': None, 'img_resize': 1200, 'img_preload': False, 'down_sample_ratio': 1, 'img_pair_strategy': 'edge_index', 'INDEX_num_of_pair': None, 'img_retrival_method': None, 'refine_iter_n_times': 2}

base_colmap_configs = {'ImageReader_camera_mode': 'auto', 'ImageReader_single_camera': False, 'min_model_size': 2, 'no_refine_intrinsics': False, 'n_threads': 16, 'use_pba': False, 'geometry_verify_thr': 15.0, \
'reregistration': {'abs_pose_max_error': 12, 'abs_pose_min_num_inliers': 30, 'abs_pose_min_inlier_ratio': 0.25, 'filter_max_reproj_error': 10}, \
'colmap_mapper_cfgs': {'init_max_error': 10, 'abs_pose_max_error': 12, 'filter_max_reproj_error': 10, 'tri_merge_max_reproj_error': 10, 'tri_complete_max_reproj_error': 10, 'tri_ignore_two_view_tracks': 0}}

matcher_cfg_dict = {'defaults': [{'override /trainer': None}, {'override /model': None}, {'override /datamodule': None}, {'override /callbacks': None}, {'override /logger': None}], 'seed': 12345, 'task_name': None, 'exp_name': 'train', 
                    'model': {'_target_': 'src.refinement_models.lightning_model.PL_MultiviewMatcher', 'pretrained_ckpt': None, 
                              'multiview_refinement': {'n_matching_steps': 1, 'enable_multiview_scale_align': False, 'backbone': {'type': 'S2DNet', 'resolution': [4, 1], 's2dnet': {'name': 's2dnet', 'num_layers': 2, 'window_size': 15, 'checkpointing': None, 'output_dim': 128, 'pretrained': 's2dnet', 'substitute_pooling_layers': True, 'combine': True, 'zoomin_strategy': 'post'}, 'pretrained': None, 'pretrained_fix': False}, 'use_fine_backbone_as_coarse': False, 'interpol_type': 'bilinear', 
                                                       'multiview_transform': {'sparse': True, 'crop_size': 35, 'window_size': 15, 'enable_rescaled_crop': False, 'enable': True, 'type': 'LoFTR', 'd_model': 128, 'nhead': 8, 'layer_names': ['self', 'cross'], 'layer_iter_n': 2, 'dropout': 0.0, 'attention': 'linear', 'norm_method': 'layernorm', 'attention_type': 'multiview', 'kernel_fn': 'elu + 1', 'd_kernel': 16, 'redraw_interval': 2, 'rezero': None, 'final_proj': False}, 'multiview_matching_train': {'enable': True, 'type': 's2d', 'detector': 'OnGrid', 'window_size': 15, 'left_point_movement_window_size': None, 'best_left_strategy': 'smallest_mean_std', 's2d': {'type': 'heatmap', 'obtain_offset_method': 'argsoftmax'}}, 'multiview_matching_test': {'enable': True, 'type': 's2d', 'detector': 'OnGrid', 'window_size': 15, 'left_point_movement_window_size': 7, 'best_left_strategy': 'smallest_mean_std', 's2d': {'type': 'heatmap', 'obtain_offset_method': 'argsoftmax'}}}, 'supervision': {'type': 'dense_grid', 'grid_scale': 8, 'fine_scale': 1, 'window_size': 15, 'sample_n_tracks_per_instance': 200, 'track_length_tolerance': 3, 'reference_points_pertubation': 2, 'scale_pertubation': 0.2, 'border_thres': 10}, 'loss': {'spg_spvs': False, 'fine_type': 'l2_with_std'}, 'trainer': {'enable_plotting': True, 'canonical_bs': 4, 'canonical_lr': 0.0002, 'scaling': None, 'world_size': None, 'n_val_pairs_to_plot': 40, 'optimizer': 'adamw', 'true_lr': None, 'backbone_lr_ratio': 0.5, 'adam_decay': 0.0, 'adamw_decay': 0.1, 'scheduler': 'MultiStepLR', 'scheduler_invervel': 'epoch', 'mslr_milestones': [2, 4, 6, 8, 10, 12, 14, 16, 18], 'mslr_gamma': 0.5, 'cosa_tmax': 30, 'elr_gamma': 0.999992}, 'eval_metrics': {'pose_estimation_method': 'RANSAC', 'ransac_pixel_thr': 1.0, 'ransac_conf': 0.99999, 'ransac_max_iters': 1000, 'epi_err_thr': 1e-06}, 'match_type': 'softmax'}, 'datamodule': {'_target_': 'src.datamodules.MultiviewMatcherDataModule.MultiviewMatcherDataModule', 'scene_info_dir': '${scene_info_dir}', 'dataset_path': '${dataset_path}', 'train_list_path': '${train_val_list_path}/train_list.txt', 'val_list_path': '${train_val_list_path}/val_list.txt', 'batch_size': 1, 'num_workers': 8, 'pin_memory': True, 'train_percent': 1, 'val_percent': 0.6, 'sort_type': 'random', 'img_pad': True, 'max_img_size': [512], 'img_resize': 840, 'depth_max_size': 2000, 'df': 8, 'coarse_scale': 0.125, 'data_sampler': 'scene_balance', 'n_samples_per_subset': 250, 'subset_sample_replacement': True, 'shuffle_within_epoch_subset': True, 'repeat_sample': 1, 'replacement': False, 'num_samples': None, 'random_seed': 666}, 'callbacks': {'model_checkpoint': {'_target_': 'pytorch_lightning.callbacks.ModelCheckpoint', 'monitor': None, 'save_top_k': -1, 'save_last': True, 'mode': 'max', 'dirpath': '${work_dir}/checkpoints/${exp_name}', 'filename': '{epoch}'}, 'lr_monitor': {'_target_': 'pytorch_lightning.callbacks.LearningRateMonitor', 'logging_interval': 'step'}}, 'logger': {'tensorboard': {'_target_': 'pytorch_lightning.loggers.TensorBoardLogger', 'save_dir': '${work_dir}/logs', 'name': '${exp_name}', 'default_hp_metric': False}, 'neptune': {'tags': ['best_model']}, 'csv_logger': {'save_dir': '.'}}, 'hydra': {'run': {'dir': '${work_dir}'}}}
